<html>
  <body bgcolor="FFFFFF">
    <CENTER>Scilab Function  </CENTER>
    <P></P>
    <H3>NAME </H3>
    <p>
      <ul>leastsq -  Solves non-linear least squares problems  </ul>
    </p>
    <H3>CALLING SEQUENCE</H3>
    <dl>
      <dd>[f,xopt]=leastsq([imp,] fun [,Dfun],x0)  </dd>
      <dd>[f,[xopt,[gradopt]]]=leastsq(fun [,Dfun],[contr],x0,['algo'],[df0,[mem]],  </dd>
      <dd>     ,[stop],['in'])  </dd>
    </dl>
    <H3>PARAMETERS</H3>
    <ul>
      <ul>
  <li>
          <tt>
            <b>imp  </b>
          </tt>
    : scalar argument used to set the trace mode. <tt>
            <b>imp=0</b>
          </tt> nothing (execpt errors) is reported, <tt>
            <b>imp=1</b>
          </tt> initial and final reports, <tt>
            <b>imp=2</b>
          </tt> adds a report per iteration, <tt>
            <b>imp&gt;2</b>
          </tt> add reports on linear search. Warning, most of these reports are written on the Scilab standard output. 
  </li>
  <li>
          <tt>
            <b>fun  </b>
          </tt>
    : external, i.e Scilab function or string (<tt>
            <b>fun</b>
          </tt> is the function defining the least square probleme: see below.
  </li>
  <li>
          <tt>
            <b>x0  </b>
          </tt>
    : real vector (initial value of variable to be minimized).
  </li>
  <li>
          <tt>
            <b>f  </b>
          </tt>
    : value of optimal least square value.
  </li>
  <li>
          <tt>
            <b>xopt  </b>
          </tt>
    : best value of <tt>
            <b>x</b>
          </tt> found.
  </li>
  <li>
          <tt>
            <b>contr  </b>
          </tt>
    : <tt>
            <b>'b',binf,bsup</b>
          </tt>  with <tt>
            <b>binf</b>
          </tt> and <tt>
            <b>bsup</b>
          </tt> real vectors with same dimension as <tt>
            <b>x0</b>
          </tt>. <tt>
            <b>binf</b>
          </tt> and <tt>
            <b>bsup</b>
          </tt> are lower and upper bounds on <tt>
            <b>x</b>
          </tt>.
  </li>
  <li>
          <tt>
            <b>algo  </b>
          </tt>
    : A string with possible values :<tt>
            <b>'qn'</b>
          </tt> or <tt>
            <b>'gc'</b>
          </tt> or <tt>
            <b>'nd'</b>
          </tt> . This string stands for quasi-Newton (default),  conjugate gradient or non-differentiable respectively.  Note that <tt>
            <b>'nd'</b>
          </tt> does not accept bounds on <tt>
            <b>x</b>
          </tt> ).
  </li>
  <li>
          <tt>
            <b>df0  </b>
          </tt>
    : real scalar. Guessed decreasing of <tt>
            <b>f</b>
          </tt> at first iteration. (<tt>
            <b>df0=1</b>
          </tt> is the default value).
  </li>
  <li>
          <tt>
            <b>mem :  </b>
          </tt>
     integer, number of variables used to approximate the  Hessian, (<tt>
            <b>algo='gc' or 'nd'</b>
          </tt>). Default value is around 6.
  </li>
  <li>
          <tt>
            <b>stop  </b>
          </tt>
    :  sequence of optional parameters controlling the  convergence of the algorithm. <tt>
            <b>  stop=  'ar',nap, [iter [,epsg [,epsf [,epsx]]]]</b>
          </tt>
  </li>
 <ul>
  <li>
            <tt>
              <b>"ar"  </b>
            </tt>
    : reserved keyword for stopping rule selection defined as follows:
  </li>
  <li>
            <tt>
              <b>nap  </b>
            </tt>
    : maximum number of calls to <tt>
              <b>fun</b>
            </tt> allowed.
  </li>
  <li>
            <tt>
              <b>iter  </b>
            </tt>
    : maximum number of iterations allowed.
  </li>
  <li>
            <tt>
              <b>epsg  </b>
            </tt>
    : threshold on gradient norm.
  </li>
  <li>
            <tt>
              <b>epsf  </b>
            </tt>
    : threshold controlling decreasing of <tt>
              <b>f</b>
            </tt>
  </li>
  <li>
            <tt>
              <b>epsx  </b>
            </tt>
    : threshold controlling variation of <tt>
              <b>x</b>
            </tt>. This vector (possibly matrix) of same size as <tt>
              <b>x0</b>
            </tt> can be used to scale <tt>
              <b>x</b>
            </tt>.
  </li>
 </ul>
  <li>
          <tt>
            <b>"in"  </b>
          </tt>
    : reserved  keyword for initialization of parameters used when <tt>
            <b>fun</b>
          </tt> in given as a Fortran routine (see below).
  </li>
  <li>
          <tt>
            <b>gradopt  </b>
          </tt>
    :  gradient of <tt>
            <b>fun</b>
          </tt> at <tt>
            <b>xopt</b>
          </tt>
  </li>
 </ul>
    </ul>
    <H3>DESCRIPTION</H3>
    <ul>
  <p>
    Non-linear optimization routine for programs without constraints or with bound constraints: 
  </p>
  <pre>
min sum(f(x).^2  w.r.t x.
   </pre>
 

  <li>fun 
    is an "external" i.e function, or list or Fortran routine (see "external"). This external must return () for a given .
  </li>
  <p>
    If <tt>
          <b>fun</b>
        </tt> is a function, the calling sequence for <tt>
          <b>fun</b>
        </tt> must be:
  </p>
  <pre>
[f]=fun(x, [optional parameters]).
   </pre>
  <p>
    Here, <tt>
          <b>fun</b>
        </tt> is a function from R^n to R^m which returns <tt>
          <b>f(x)</b>
        </tt>, a
    real vector ( value of function at <tt>
          <b>x</b>
        </tt>) 
  </p>
  <p>
    If fun is defined by a Fortran or C routine first argument must be a
    list:
    \list(fun_name,m,...)
    If <tt>
          <b>fun_name</b>
        </tt> is a character string, it refers to the name of the routine
    which must be linked to Scilab. 
  </p>
  <p>
    Here, the generic calling sequence for the Fortran subroutine is: 
    <tt>
          <b>subroutine fun(m,n,x,td,f)</b>
        </tt>
  </p>
  <p>
  </p>
  <p>
    <tt>
          <b>n</b>
        </tt> is the dimension of <tt>
          <b>x</b>
        </tt>, <tt>
          <b>x</b>
        </tt> is an <tt>
          <b>n</b>
        </tt> vector, 
    <tt>
          <b>td</b>
        </tt> are working arrays which may also be used to pass parameters
  </p>
  <p>
  </p>
  <p>
    If <tt>
          <b>fun</b>
        </tt> is given as a Fortran routine, it is possible to initialize
    parameters or to send Scilab variables to this routine using sequence
    of arguments <tt>
          <b>'td' , valtd</b>
        </tt>. Then, the Fortran function
    <tt>
          <b>fun(m,n , x, f, td)</b>
        </tt> is evaluated with  <tt>
          <b>td=valtd</b>
        </tt>.
    Thus, the Scilab variables  <tt>
          <b>valtd</b>
        </tt>  are sent to the Fortran
    function <tt>
          <b>fun</b>
        </tt>.
  </p>

  <li>Dfun 
    is an "external".This external must return a matrix  such  as () for a given . 
  </li>
  <p>
    If <tt>
          <b>Dfun</b>
        </tt> is a function, the calling sequence for <tt>
          <b>fun</b>
        </tt> must be:
  </p>
  <pre>
[g]=Dfun(x, [optional parameters]).
   </pre>
  <p>
    If Dfun is defined by a Fortran or C routine first argument must be a
    list:
    \list(fun_name,m,...)
    If <tt>
          <b>fun_name</b>
        </tt> is a character string, it refers to the name of the routine
    which must be linked to Scilab. 
  </p>
  <p>
    Here, the generic calling sequence for the Fortran subroutine is: 
    <tt>
          <b>subroutine dfun(m,n,x,td,g)</b>
        </tt>
  </p>
  <p>
  </p>
  <p>
  </p>
 
  </ul>
    <H3>EXAMPLES</H3>
    <ul>
      <pre>

a=rand(3,2);b=[1;1;1];x0=[1;-1];
deff('f=fun(x,a,b)','f=a*x-b');
deff('g=dfun(x,a,b)','g=a');

[f,xopt]=leastsq(fun,x0)      //Simplest call
xopt-a\b  //compare with linear algebra solution

[f,xopt]=leastsq(fun,dfun,x0)      //specify gradient

[f,xopt]=leastsq(list(fun,[1 2;3 4],[1;2]),x0)    

deff('f=fun(x,a,b)','f=exp(a*x)-b');
deff('g=dfun(x,a,b)','g=a.*(exp(a*x)*ones(1,size(a,2)))');

[f,xopt]=leastsq(list(fun,[1 2;3 4],[1;2]),x0)  
 </pre>
    </ul>
    <H3>SEE ALSO</H3>
    <p>
      <ul>
        <a href="../programming/external.html">
          <tt>
            <b>external</b>
          </tt>
        </a>
        <a href="quapro.html">
          <tt>
            <b>quapro</b>
          </tt>
        </a>
        <a href="../elementary/mps2linpro.html">
          <tt>
            <b>linpro</b>
          </tt>
        </a>
      </ul>
    </p>
  </body>
</html>