 
getf SCI/util/testexamples.sci
 
reinit_for_test()
 
%U=mopen('SCI/tests/automatic_tests/mfile2sci_data.ref','rb');
 
// Create a simple M-file
 
write(TMPDIR + '/rot90.m', ['function B = rot90(A,k)';
  '[m,n] = size(A);';
  'if nargin == 1';
  '    k = 1;';
  'else';
  '    k = rem(k,4);';
  '    if k < 0';
  '        k = k + 4;';
  '    end';
  'end';
  'if k == 1';
  '    A = A.'';';
  '    B = A(n:-1:1,:);';
  'elseif k == 2';
  '    B = A(m:-1:1,n:-1:1);';
  'elseif k == 3';
  '    B = A(m:-1:1,:);';
  '    B = B.'';';
  'else';
  '    B = A;';
  'end']);
 
// Convert it to scilab
 
%ans = mfile2sci(TMPDIR + '/rot90.m', TMPDIR);
  ****** Beginning of mfile2sci() session ******
  File to convert: TMPDIR/rot90.m
  Result file path: TMPDIR/
  Recursive mode: OFF
  Only double values used in M-file: NO
  Verbose mode: 3
  Generate formated code: NO
  M-file reading...
  M-file reading: Done
  Syntax modification...
  Syntax modification: Done
  Macro to tree conversion...
  Conversion of M-tree...
  Line 2 out of 23...
  Line 2 out of 23...
  Line 3 out of 23...
  Line 10 out of 23...
  Line 11 out of 23...
  Line 21 out of 23...
  Conversion of M-tree: Done
  Macro to tree conversion: Done
  ****** End of mfile2sci() session ******
 
if load_ref('%ans') then   bugmes();quit;end,
 
 
// Show the new code
 
%ans = write(%io(2), read(TMPDIR + '/rot90.sci', -1, 1, '(a)'));
function [B] = rot90(A,k)
 
// Ouput variables initialisation (not found in input variables)
B=[];
 
// Number of arguments in function call
[%nargout,%nargin] = argn(0)
 
// Display mode
mode(0);
 
// Display warning for floating point exception
ieee(1);
 
[m,n] = size(mtlb_double(A));
if %nargin==1 then
  k = 1;
else
  k = mtlb_double(k)-fix(mtlb_double(k)0./4)0.*4;
  if mtlb_logic(k,"<",0) then
    k = mtlb_a(k,4);
  end;
end;
if mtlb_logic(mtlb_double(k),"==",1) then
  A = mtlb_0(A);
  B = A(n:-1:1,:);
elseif mtlb_logic(mtlb_double(k),"==",2) then
  B = A(m:-1:1,n:-1:1);
elseif mtlb_logic(mtlb_double(k),"==",3) then
  B = A(m:-1:1,:);
  B = mtlb_0(B);
else
  B = A;
end;
endfunction
 
if load_ref('%ans') then   bugmes();quit;end,
 
 
// get it into scilab
 
%ans = getf(TMPDIR + '/rot90.sci');
 
if load_ref('%ans') then   bugmes();quit;end,
 
 
// Execute it
 
m = rand(4, 2);%ans = rot90(m, 1);
 
if load_ref('%ans') then   bugmes();quit;end,
 
 
xdel_run(winsid());
 
 
mclose(%U);
 
