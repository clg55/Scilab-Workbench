// Copyright INRIA
// Scilab Project - V. Couvert
// This batch compare reference files generated by two different Matlab versions

// PLEASE CUSTOM 'NEWVERSIONDIR' and 'OLDVERSIONDIR'

mode(-1);

NEWVERSIONDIR = "/home/couvert/newm2scitests/generated_files/"
OLDVERSIONDIR = "/home/couvert/newm2scitests/generated_files/matlab_6.5_R13/"

// List all files
files=listfiles(NEWVERSIONDIR+"*.m");

while k<size(files,"*")
  if strindex(files(k),"_ref")==[] then
    files(k)=[]
  else
    k=k+1
  end
end

for k=1:size(files,"*")
  newfile=mopen(files(k));
  oldfile=mopen(OLDVERSIONDIR+basename(files(k))+".m");
  
  newfiletxt=mgetl(newfile)
  oldfiletxt=mgetl(oldfile)
  
  // Del Matlab version line
  newfiletxt(4)=[]
  oldfiletxt(4)=[]
  
  if or(newfiletxt<>oldfiletxt) then
    write(%io(2),"Reference has changed for "+basename(files(k)));
  end
  
  mclose(newfile);
  mclose(oldfile);
end
