// initialisation des variables globales d'environnement Scilab pour la qualification
// repertoire de qualification de la machine cible
// repertoire de travail
// repertoire des fonctions necessaire pour l'environnement de qualif
// repertoire des résulats
// la version en cours de qualification (et pour le repertoire sous resultats)


global envq_qualif envq_work envq_proc envq_log envq_ver 
if MSDOS then 
   envq_qualif = "e:\qualif\"
   envq_work   = "e:\qualif\work\"
   envq_proc   = "e:\qualif\proc\"
   envq_log    = "e:\qualif\log\"
//   prefix_os_cmd = "%SystemRoot%\system32\cmd.exe /e:on /v:on /K e:\qualif\proc\init_qualif.bat&"
else
   envq_qualif = "$HOME/qualif"
   envq_work   = "$HOME/qualif/work"
   envq_proc   = "$HOME/qualif/proc"
   envq_log    = "$HOME/qualif/log"
end // du if

envq_ver    = getversion()

global dos_command not_dos_command os_cmd
dos_command=tlist(['dos command';'copyftp';'runtest';'copyrun';'clearlog';'clearwork'], ..
                                 "copyftp ","runtest ","copyrun dos", "clearlog ", "clearwork ")
//                                 "copyftp ","runtest ","copyrun dos", "erase /s /q ", "rmdir /s /q ") 
not_dos_command=tlist(['not dos command';'copyftp';'runtest';'copyrun';'clearlog';'clearwork'],"copyftp unix","runtest unix","copyrun unix","clearlog unix","clearwork unix") 
os_cmd=tlist(['operating system';'%t';'%f'],dos_command,not_dos_command)

lines (0)

//créer le répertoire de la version en cours de qualification sous le repertoire log s'il n'existe pas déjà
if ~isdir (envq_log+envq_ver) then 
      unix("mkdir "+envq_log+envq_ver)
end

getf (envq_proc + "fonct_qualif.sci")

//ajout des menus personnalisés pour l'environnement de Qualification


// affichage des menus si scilab lance en mode windows
if strindex(strcat(sciargs(),'!'),'!-nw!') == [] then

   delmenu('Qualif_Run');
   addmenu('Qualif_Run',[
                         'CopyFtp'     ;
                         'RunTest'     ;
                         'CopyRun'     ;
                         'ClearLog'    ;
                         'ClearWork'   ;
                         '-';
                         'CopyFtp   *' ;
                         'RunTest   *' ;
                         'CopyRun   *' ;
                         'ClearLog  *' ;
                         'ClearWork *' ;
                        ]);
   Qualif_Run=[
               'graph_cmd(""copyftp"","""")'  ;
               'graph_cmd(""runtest"",envq_work)' ;
               'graph_cmd(""copyrun"",envq_work)'  ;
               'graph_cmd(""clearlog"",(envq_log+envq_ver+""\""))'  ;
               'graph_cmd(""clearwork"",envq_work)'         ; 
               '' ;
               'copyftp   (""*"")'   ;  
               'if x_message([""Continue RunTest * ...""],[""No"",""Yes""])==2 then          ..
                   exec_cmd(""runtest"",envq_work,find_tests_suite_up_to_date(envq_work)); end'   ; 
               'copyrun   (""*"")'   ; 
               'if x_message([""Continue ClearLog * ...""],[""No"",""Yes""])==2 then          ..
                   exec_cmd(""clearlog"",(envq_log+envq_ver+""\""),find_tests_suite_up_to_date(envq_log+envq_ver+""\"")); end'   ; 
               'if x_message([""Continue ClearWork * ...""],[""No"",""Yes""])==2 then          ..
                   exec_cmd(""clearwork"",envq_work,find_tests_suite_up_to_date(envq_work)); end'   ; 
              ] ;


   delmenu('Qualif_View');
   addmenu('Qualif_View',[ 
                          'HomeCls' ; 
                          'Cls' ; 
                          '-' ; 
                          'DirLog' ; 
                          'DirWork' ; 
                          '-' ; 
                          'ShowLog' ; 
                          //'CatLog' ; 
                          //'-' ; 
                          //'ShowLog *' ;
                         ]);
   Qualif_View=[
                 'disp(""homecls"")' ; 
                 'disp(""cls"")' ; 
                 '' ; 
                 'disp(""*** LOG\""+envq_ver+"" Directory ***"");disp(sort(strsubst(listfiles(envq_log+envq_ver+""\*""),envq_log+envq_ver+""\"","""")));';
                 'disp(""*** WORK Directory ***"");disp(sort(strsubst(listfiles(envq_work+""*""),envq_work,"""")));'; 
                 '' ;
                 'disp(""*** LOG\""+envq_ver+"" Directory ***"");showlog(strcat(find_tests_suite_up_to_date(envq_log+envq_ver+""\""),"" ""));' ; 
                 //'disp(""catlog"")';
                 //'' ;
                 //'showlog (""*"")' ;
                ] ;


   delmenu('Qualif_Help');
   addmenu('Qualif_Help',['CopyFtp';'RunTest';'CopyRun';'ClearLog';'ClearWork']);
   Qualif_Help=['copyftp(""--help"");' ; 'runtest(""--help"");' ; 'copyrun(""--help"");' ; 'clearlog(""--help"");' ; 'clearwork(""--help"");'] ;


end // du if
