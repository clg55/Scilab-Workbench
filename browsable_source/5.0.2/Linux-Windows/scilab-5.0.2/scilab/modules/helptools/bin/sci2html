#!/bin/sh

# Scilab ( http://www.scilab.org/ ) - This file is part of Scilab
# Copyright (C) 2008 - INRIA
#
# This file must be used under the terms of the CeCILL.
# This source file is licensed as described in the file COPYING, which
# you should have received as part of this distribution.  The terms
# are also available at
# http://www.cecill.info/licences/Licence_CeCILL_V2-en.txt

if [ $# -ne 2 ]; then
    echo "Usage: sci2html in_xml_file out_html_directory"
    echo "Converts an XML document conforming to scilab.rnc"
    echo "to multi-page HTML."
    exit 1
fi

binDir=`dirname $0`
libDir=$binDir/../../../thirdparty
docbookXslDir=$binDir/../docbook_xsl
cssDir=$binDir/../css

baseName=`basename $1`
flatXMLFile="$2/$baseName"

cp=$libDir/sci_doc_kit.jar:\
$libDir/jeuclid-core.jar:$libDir/commons-logging.jar:\
$libDir/batik.jar:$libDir/js.jar

java -cp "$cp" org.scilab.doc_kit.CopyConvert "$1" "$flatXMLFile"

type xsltproc 1> /dev/null 2>&1
if [ $? -eq 0 ]; then

    xsltproc --stringparam base.dir "$2/" \
        --stringparam use.id.as.filename 1 \
        --stringparam html.stylesheet "html.css" \
        --stringparam toc.section.depth 3 \
        --stringparam section.autolabel 1 \
            "$docbookXslDir/html/chunk.xsl" "$flatXMLFile"

else

    java -Xmx512m -cp "$libDir/saxon.jar:$libDir/docbook-xsl-saxon.jar" \
        com.icl.saxon.StyleSheet \
        "$flatXMLFile" \
        "$docbookXslDir/html/chunk.xsl" \
        base.dir="$2/" \
        use.id.as.filename=1 \
        html.stylesheet=html.css \
        use.extensions=1 \
        graphicsize.extension=0 \
        toc.section.depth=3 \
        section.autolabel=1

fi

rm -f "$flatXMLFile"
cp "$cssDir/html.css" "$2"


